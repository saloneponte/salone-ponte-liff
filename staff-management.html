<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç† - Salone Ponte</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="/src/styles/tailwind-compiled.css" rel="stylesheet">
  <style>
    .modal {
      @apply fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50;
    }
    
    .modal.active {
      @apply flex;
    }

    .role-manager { @apply bg-purple-100 text-purple-800; }
    .role-senior { @apply bg-blue-100 text-blue-800; }
    .role-stylist { @apply bg-green-100 text-green-800; }
    .role-assistant { @apply bg-yellow-100 text-yellow-800; }
    .role-trainee { @apply bg-gray-100 text-gray-800; }

    .image-preview {
      position: relative;
      display: inline-block;
    }

    .image-preview img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 50%;
    }

    .image-preview .remove-btn {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
    }

    .skill-tag {
      @apply inline-block px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 mr-2 mb-2;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="container mx-auto px-4 py-6 max-w-7xl">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="flex justify-between items-center mb-8">
      <div>
        <div class="flex items-center gap-4 mb-2">
          <button onclick="history.back()" class="text-gray-500 hover:text-gray-700">
            â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
          </button>
        </div>
        <h1 class="text-3xl font-bold text-gray-800">ğŸ‘¨â€ğŸ’¼ ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</h1>
        <p class="text-gray-600">ã‚¹ã‚¿ãƒƒãƒ•ã®ç™»éŒ²ãƒ»ç·¨é›†ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</p>
      </div>
      <div class="flex space-x-3">
        <button id="addStaffBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
          + æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ 
        </button>
        <button id="exportBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
          ğŸ“Š CSVå‡ºåŠ›
        </button>
      </div>
    </div>

    <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ã‚¹ã‚¿ãƒƒãƒ•æ¤œç´¢</label>
          <input type="text" id="searchInput" placeholder="åå‰ã§æ¤œç´¢" 
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">å½¹è·</label>
          <select id="roleFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">å…¨ã¦</option>
            <option value="åº—é•·">åº—é•·</option>
            <option value="ãƒˆãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ">ãƒˆãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ</option>
            <option value="ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ">ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ</option>
            <option value="ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ">ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</option>
            <option value="ç ”ä¿®ç”Ÿ">ç ”ä¿®ç”Ÿ</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">å‹¤å‹™çŠ¶æ³</label>
          <select id="statusFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">å…¨ã¦</option>
            <option value="active">åœ¨ç±ä¸­</option>
            <option value="vacation">ä¼‘æš‡ä¸­</option>
            <option value="inactive">é€€è·</option>
          </select>
        </div>
        <div class="flex items-end">
          <button id="resetFilter" class="w-full bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors">
            ãƒªã‚»ãƒƒãƒˆ
          </button>
        </div>
      </div>
    </div>

    <!-- çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
          <div class="p-3 rounded-full bg-blue-100 text-blue-600">
            ğŸ‘¨â€ğŸ’¼
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">ç·ã‚¹ã‚¿ãƒƒãƒ•æ•°</p>
            <p class="text-2xl font-semibold text-gray-900" id="totalStaff">0</p>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
          <div class="p-3 rounded-full bg-green-100 text-green-600">
            âœ…
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">åœ¨ç±ä¸­</p>
            <p class="text-2xl font-semibold text-gray-900" id="activeStaff">0</p>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
          <div class="p-3 rounded-full bg-purple-100 text-purple-600">
            â­
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ</p>
            <p class="text-2xl font-semibold text-gray-900" id="stylistCount">0</p>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
          <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
            ğŸ†•
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</p>
            <p class="text-2xl font-semibold text-gray-900" id="assistantCount">0</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ -->
    <div class="bg-white rounded-lg shadow-md">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§</h3>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6" id="staffGrid">
        <!-- ã‚¹ã‚¿ãƒƒãƒ•ã‚«ãƒ¼ãƒ‰ã¯å‹•çš„ã«ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <!-- ã‚¹ã‚¿ãƒƒãƒ•ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="staffModal" class="modal">
    <div class="bg-white rounded-lg w-full max-w-4xl mx-4 max-h-full overflow-y-auto">
      <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
        <h3 class="text-lg font-semibold text-gray-900" id="modalTitle">ã‚¹ã‚¿ãƒƒãƒ•ç·¨é›†</h3>
        <button id="closeModal" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="p-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- åŸºæœ¬æƒ…å ± -->
          <div>
            <h4 class="font-semibold mb-4">åŸºæœ¬æƒ…å ±</h4>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">æ°å *</label>
                <input type="text" id="editStaffName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md" required>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700">å½¹è· *</label>
                  <select id="editStaffRole" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md" required>
                    <option value="åº—é•·">åº—é•·</option>
                    <option value="ãƒˆãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ">ãƒˆãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ</option>
                    <option value="ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ">ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ</option>
                    <option value="ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ">ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</option>
                    <option value="ç ”ä¿®ç”Ÿ">ç ”ä¿®ç”Ÿ</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">å‹¤å‹™çŠ¶æ³</label>
                  <select id="editStaffStatus" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="active">åœ¨ç±ä¸­</option>
                    <option value="vacation">ä¼‘æš‡ä¸­</option>
                    <option value="inactive">é€€è·</option>
                  </select>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700">é›»è©±ç•ªå·</label>
                  <input type="tel" id="editStaffPhone" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                  <input type="email" id="editStaffEmail" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">å…¥ç¤¾æ—¥</label>
                <input type="date" id="editStaffHireDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">è‡ªå·±ç´¹ä»‹</label>
                <textarea id="editStaffBio" rows="4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
                          placeholder="ãŠå®¢æ§˜ã«å‘ã‘ãŸè‡ªå·±ç´¹ä»‹ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
              </div>
            </div>
          </div>
          
          <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒãƒ»ã‚¹ã‚­ãƒ« -->
          <div>
            <h4 class="font-semibold mb-4">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ</h4>
            <div class="space-y-4 mb-6">
              <div>
                <input type="file" id="staffPhotoUpload" accept="image/*" class="hidden">
                <button onclick="document.getElementById('staffPhotoUpload').click()" 
                        class="w-full bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 border-2 border-dashed border-blue-300">
                  ğŸ“· ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                </button>
                <p class="text-sm text-gray-500 mt-2">æ¨å¥¨ã‚µã‚¤ã‚º: 400x400pxï¼ˆæ­£æ–¹å½¢ï¼‰</p>
              </div>
              
              <!-- å†™çœŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
              <div id="photoPreview" class="flex justify-center">
                <!-- å†™çœŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯å‹•çš„ã«ç”Ÿæˆ -->
              </div>
              
              <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL -->
              <div>
                <label class="block text-sm font-medium text-gray-700">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL</label>
                <input type="url" id="editStaffPhotoURL" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
                       placeholder="https://example.com/image.jpg">
              </div>
            </div>

            <h4 class="font-semibold mb-4">å°‚é–€ã‚¹ã‚­ãƒ«ãƒ»å¾—æ„åˆ†é‡</h4>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">å¾—æ„ãƒ¡ãƒ‹ãƒ¥ãƒ¼</label>
                <textarea id="editStaffSpecialty" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
                          placeholder="ã‚«ãƒƒãƒˆã€ã‚«ãƒ©ãƒ¼ã€ãƒ‘ãƒ¼ãƒãªã©å¾—æ„ãªæŠ€è¡“ã‚’å…¥åŠ›"></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">ã‚¹ã‚­ãƒ«ã‚¿ã‚°</label>
                <div id="skillTags" class="mb-2">
                  <!-- ã‚¹ã‚­ãƒ«ã‚¿ã‚°ã¯å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                <div class="flex gap-2">
                  <input type="text" id="newSkillInput" placeholder="æ–°ã—ã„ã‚¹ã‚­ãƒ«ã‚’å…¥åŠ›" 
                         class="flex-1 px-3 py-2 border border-gray-300 rounded-md">
                  <button id="addSkillBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">
                    è¿½åŠ 
                  </button>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">çµŒé¨“å¹´æ•°</label>
                <input type="number" id="editStaffExperience" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md" min="0">
              </div>
            </div>
          </div>
        </div>
        
        <!-- å‹¤å‹™è¨­å®š -->
        <div class="mt-8">
          <h4 class="font-semibold mb-4">å‹¤å‹™è¨­å®š</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">å‹¤å‹™æ›œæ—¥</label>
              <div class="grid grid-cols-7 gap-2">
                <label class="flex items-center">
                  <input type="checkbox" id="workday-0" class="mr-1">
                  <span class="text-sm">æ—¥</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" id="workday-1" class="mr-1">
                  <span class="text-sm">æœˆ</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" id="workday-2" class="mr-1">
                  <span class="text-sm">ç«</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" id="workday-3" class="mr-1">
                  <span class="text-sm">æ°´</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" id="workday-4" class="mr-1">
                  <span class="text-sm">æœ¨</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" id="workday-5" class="mr-1">
                  <span class="text-sm">é‡‘</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" id="workday-6" class="mr-1">
                  <span class="text-sm">åœŸ</span>
                </label>
              </div>
            </div>
            <div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700">é–‹å§‹æ™‚é–“</label>
                  <input type="time" id="editStaffStartTime" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">çµ‚äº†æ™‚é–“</label>
                  <input type="time" id="editStaffEndTime" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="mt-8 flex justify-between">
          <button id="deleteStaffBtn" class="bg-red-500 text-white px-6 py-2 rounded-md hover:bg-red-600">
            å‰Šé™¤
          </button>
          <div class="flex gap-3">
            <button id="cancelEditBtn" class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600">
              ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
            <button id="saveStaffBtn" class="bg-green-500 text-white px-6 py-2 rounded-md hover:bg-green-600">
              ä¿å­˜
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <script>
    // Firebase åˆæœŸåŒ–
    const firebaseConfig = {
      apiKey: "AIzaSyAK14FMyp7VGYZPakGDmLdgHsvvxT-b0TM",
      authDomain: "salone-ponte-fceca.firebaseapp.com",
      projectId: "salone-ponte-fceca",
      storageBucket: "salone-ponte-fceca.appspot.com",
      messagingSenderId: "463711728652",
      appId: "1:463711728652:web:59c749e11d201b26b86a29",
      measurementId: "G-MPWGTB6R7C"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let staffsData = [];
    let filteredStaffs = [];
    let currentStaff = null;

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      loadStaffs();
      setupEventListeners();
    });

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    function setupEventListeners() {
      // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
      document.getElementById('searchInput').addEventListener('input', applyFilters);
      document.getElementById('roleFilter').addEventListener('change', applyFilters);
      document.getElementById('statusFilter').addEventListener('change', applyFilters);
      document.getElementById('resetFilter').addEventListener('click', resetFilters);

      // ãƒœã‚¿ãƒ³
      document.getElementById('addStaffBtn').addEventListener('click', openNewStaffModal);
      document.getElementById('exportBtn').addEventListener('click', exportToCSV);

      // ãƒ¢ãƒ¼ãƒ€ãƒ«
      document.getElementById('closeModal').addEventListener('click', closeModal);
      document.getElementById('cancelEditBtn').addEventListener('click', closeModal);
      document.getElementById('saveStaffBtn').addEventListener('click', saveStaff);
      document.getElementById('deleteStaffBtn').addEventListener('click', deleteStaff);

      // ã‚¹ã‚­ãƒ«ãƒ»å†™çœŸ
      document.getElementById('addSkillBtn').addEventListener('click', addSkill);
      document.getElementById('staffPhotoUpload').addEventListener('change', handlePhotoUpload);
    }

    // ã‚¹ã‚¿ãƒƒãƒ•ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    async function loadStaffs() {
      try {
        const snapshot = await db.collection('staffs').get();
        staffsData = [];
        
        snapshot.forEach(doc => {
          const data = doc.data();
          staffsData.push({
            id: doc.id,
            ...data,
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š
            status: data.status || 'active',
            bio: data.bio || '',
            specialty: data.specialty || '',
            skills: data.skills || [],
            experience: data.experience || 0,
            workdays: data.workdays || [1,2,3,4,5], // æœˆ-é‡‘
            startTime: data.startTime || '10:00',
            endTime: data.endTime || '19:00'
          });
        });
        
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ä½œæˆ
        if (staffsData.length === 0) {
          await createSampleStaffs();
        }
        
        filteredStaffs = [...staffsData];
        renderStaffs();
        updateStatistics();
        
      } catch (error) {
        console.error('ã‚¹ã‚¿ãƒƒãƒ•èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚¹ã‚¿ãƒƒãƒ•ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    // ã‚µãƒ³ãƒ—ãƒ«ã‚¹ã‚¿ãƒƒãƒ•ä½œæˆ
    async function createSampleStaffs() {
      const sampleStaffs = [
        {
          name: 'å±±ç”° ã•ãã‚‰',
          role: 'ãƒˆãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ',
          status: 'active',
          specialty: 'ã‚«ãƒ©ãƒ¼ãƒªãƒ³ã‚°ã€ãƒ˜ã‚¢ã‚±ã‚¢',
          bio: 'ãŠå®¢æ§˜ã®é­…åŠ›ã‚’æœ€å¤§é™ã«å¼•ãå‡ºã™ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã”ææ¡ˆã—ã¾ã™',
          skills: ['ã‚«ãƒ©ãƒ¼', 'ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ', 'ãƒ˜ã‚¢ã‚±ã‚¢'],
          experience: 8,
          workdays: [1,2,3,4,5],
          startTime: '10:00',
          endTime: '19:00'
        },
        {
          name: 'ç”°ä¸­ å¥å¤ª',
          role: 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ',
          status: 'active',
          specialty: 'ã‚«ãƒƒãƒˆã€ãƒ‘ãƒ¼ãƒ',
          bio: 'ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’å–ã‚Šå…¥ã‚ŒãŸå€‹æ€§çš„ãªã‚¹ã‚¿ã‚¤ãƒ«ãŒå¾—æ„ã§ã™',
          skills: ['ã‚«ãƒƒãƒˆ', 'ãƒ‘ãƒ¼ãƒ', 'ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°'],
          experience: 5,
          workdays: [1,2,3,4,5,6],
          startTime: '10:00',
          endTime: '19:00'
        },
        {
          name: 'ä½ã€…æœ¨ ç¾é¦™',
          role: 'ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ',
          status: 'active',
          specialty: 'ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ã€ãƒ–ãƒ­ãƒ¼',
          bio: 'ä¸å¯§ãªã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ã¨ãƒ–ãƒ­ãƒ¼ã§ãŠå®¢æ§˜ã‚’ãƒªãƒ©ãƒƒã‚¯ã‚¹ã•ã›ã¾ã™',
          skills: ['ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼', 'ãƒ–ãƒ­ãƒ¼', 'ãƒ˜ãƒƒãƒ‰ã‚¹ãƒ‘'],
          experience: 2,
          workdays: [0,1,2,3,4,5],
          startTime: '10:00',
          endTime: '18:00'
        }
      ];

      for (const staff of sampleStaffs) {
        staff.createdAt = new Date().toISOString();
        await db.collection('staffs').add(staff);
      }
      
      // å†èª­ã¿è¾¼ã¿
      await loadStaffs();
    }

    // ã‚¹ã‚¿ãƒƒãƒ•è¡¨ç¤º
    function renderStaffs() {
      const grid = document.getElementById('staffGrid');
      grid.innerHTML = '';

      if (filteredStaffs.length === 0) {
        grid.innerHTML = '<p class="text-gray-500 text-center col-span-full">ã‚¹ã‚¿ãƒƒãƒ•ãŒã„ã¾ã›ã‚“</p>';
        return;
      }

      filteredStaffs.forEach(staff => {
        const card = document.createElement('div');
        card.className = 'border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow cursor-pointer';
        
        const roleClass = getRoleClass(staff.role);
        const statusBadge = getStatusBadge(staff.status);
        
        card.innerHTML = `
          <div class="relative">
            <img src="${staff.photoURL || 'https://via.placeholder.com/200x200?text=No+Image'}" 
                 alt="${staff.name}" class="w-full h-48 object-cover">
            <div class="absolute top-2 left-2">
              <span class="text-xs px-2 py-1 rounded-full ${roleClass}">${staff.role}</span>
            </div>
            <div class="absolute top-2 right-2">
              ${statusBadge}
            </div>
          </div>
          <div class="p-4">
            <h3 class="font-semibold text-lg mb-2">${staff.name}</h3>
            <p class="text-gray-600 text-sm mb-3 line-clamp-2">${staff.bio || 'è‡ªå·±ç´¹ä»‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“'}</p>
            
            <div class="mb-3">
              <p class="text-sm font-medium text-gray-700">å¾—æ„åˆ†é‡:</p>
              <p class="text-sm text-gray-600">${staff.specialty || 'æœªè¨­å®š'}</p>
            </div>
            
            <div class="mb-3">
              <p class="text-sm font-medium text-gray-700">ã‚¹ã‚­ãƒ«:</p>
              <div class="flex flex-wrap gap-1 mt-1">
                ${staff.skills.slice(0, 3).map(skill => 
                  `<span class="skill-tag">${skill}</span>`
                ).join('')}
                ${staff.skills.length > 3 ? `<span class="text-xs text-gray-500">+${staff.skills.length - 3}</span>` : ''}
              </div>
            </div>
            
            <div class="flex justify-between items-center">
              <div class="text-sm text-gray-500">
                çµŒé¨“${staff.experience}å¹´
              </div>
              <button onclick="openStaffModal('${staff.id}')" 
                      class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                ç·¨é›†
              </button>
            </div>
          </div>
        `;
        
        grid.appendChild(card);
      });
    }

    // å½¹è·ã‚¯ãƒ©ã‚¹å–å¾—
    function getRoleClass(role) {
      const classMap = {
        'åº—é•·': 'role-manager',
        'ãƒˆãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ': 'role-senior',
        'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ': 'role-stylist',
        'ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ': 'role-assistant',
        'ç ”ä¿®ç”Ÿ': 'role-trainee'
      };
      return classMap[role] || 'role-stylist';
    }

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸å–å¾—
    function getStatusBadge(status) {
      const badgeMap = {
        'active': '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">åœ¨ç±ä¸­</span>',
        'vacation': '<span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">ä¼‘æš‡ä¸­</span>',
        'inactive': '<span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">é€€è·</span>'
      };
      return badgeMap[status] || '';
    }

    // çµ±è¨ˆæ›´æ–°
    function updateStatistics() {
      const total = staffsData.filter(s => s.status === 'active').length;
      const active = staffsData.filter(s => s.status === 'active').length;
      const stylists = staffsData.filter(s => 
        (s.role === 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ' || s.role === 'ãƒˆãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ' || s.role === 'åº—é•·') && 
        s.status === 'active'
      ).length;
      const assistants = staffsData.filter(s => 
        (s.role === 'ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ' || s.role === 'ç ”ä¿®ç”Ÿ') && 
        s.status === 'active'
      ).length;
      
      document.getElementById('totalStaff').textContent = total;
      document.getElementById('activeStaff').textContent = active;
      document.getElementById('stylistCount').textContent = stylists;
      document.getElementById('assistantCount').textContent = assistants;
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
    function applyFilters() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const roleFilter = document.getElementById('roleFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;
      
      filteredStaffs = staffsData.filter(staff => {
        // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        if (searchTerm && !staff.name.toLowerCase().includes(searchTerm)) {
          return false;
        }
        
        // å½¹è·ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        if (roleFilter && staff.role !== roleFilter) {
          return false;
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        if (statusFilter && staff.status !== statusFilter) {
          return false;
        }
        
        return true;
      });
      
      renderStaffs();
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆ
    function resetFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('roleFilter').value = '';
      document.getElementById('statusFilter').value = '';
      filteredStaffs = [...staffsData];
      renderStaffs();
    }

    // æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•ãƒ¢ãƒ¼ãƒ€ãƒ«
    function openNewStaffModal() {
      currentStaff = null;
      document.getElementById('modalTitle').textContent = 'æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ ';
      clearStaffForm();
      document.getElementById('deleteStaffBtn').style.display = 'none';
      document.getElementById('staffModal').classList.add('active');
    }

    // ã‚¹ã‚¿ãƒƒãƒ•ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«
    function openStaffModal(staffId) {
      currentStaff = staffsData.find(s => s.id === staffId);
      if (!currentStaff) return;
      
      document.getElementById('modalTitle').textContent = 'ã‚¹ã‚¿ãƒƒãƒ•ç·¨é›†';
      loadStaffToForm();
      document.getElementById('deleteStaffBtn').style.display = 'block';
      document.getElementById('staffModal').classList.add('active');
    }

    // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
    function clearStaffForm() {
      document.getElementById('editStaffName').value = '';
      document.getElementById('editStaffRole').value = 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ';
      document.getElementById('editStaffStatus').value = 'active';
      document.getElementById('editStaffPhone').value = '';
      document.getElementById('editStaffEmail').value = '';
      document.getElementById('editStaffHireDate').value = '';
      document.getElementById('editStaffBio').value = '';
      document.getElementById('editStaffPhotoURL').value = '';
      document.getElementById('editStaffSpecialty').value = '';
      document.getElementById('editStaffExperience').value = '';
      document.getElementById('editStaffStartTime').value = '10:00';
      document.getElementById('editStaffEndTime').value = '19:00';
      
      // å‹¤å‹™æ›œæ—¥ãƒªã‚»ãƒƒãƒˆï¼ˆæœˆ-é‡‘ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
      for (let i = 0; i < 7; i++) {
        document.getElementById(`workday-${i}`).checked = (i >= 1 && i <= 5);
      }
      
      renderSkillTags([]);
      renderPhotoPreview();
    }

    // ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«èª­ã¿è¾¼ã¿
    function loadStaffToForm() {
      document.getElementById('editStaffName').value = currentStaff.name;
      document.getElementById('editStaffRole').value = currentStaff.role;
      document.getElementById('editStaffStatus').value = currentStaff.status;
      document.getElementById('editStaffPhone').value = currentStaff.phone || '';
      document.getElementById('editStaffEmail').value = currentStaff.email || '';
      document.getElementById('editStaffHireDate').value = currentStaff.hireDate || '';
      document.getElementById('editStaffBio').value = currentStaff.bio || '';
      document.getElementById('editStaffPhotoURL').value = currentStaff.photoURL || '';
      document.getElementById('editStaffSpecialty').value = currentStaff.specialty || '';
      document.getElementById('editStaffExperience').value = currentStaff.experience || 0;
      document.getElementById('editStaffStartTime').value = currentStaff.startTime || '10:00';
      document.getElementById('editStaffEndTime').value = currentStaff.endTime || '19:00';
      
      // å‹¤å‹™æ›œæ—¥è¨­å®š
      const workdays = currentStaff.workdays || [1,2,3,4,5];
      for (let i = 0; i < 7; i++) {
        document.getElementById(`workday-${i}`).checked = workdays.includes(i);
      }
      
      renderSkillTags(currentStaff.skills || []);
      renderPhotoPreview();
    }

    // ã‚¹ã‚­ãƒ«ã‚¿ã‚°è¡¨ç¤º
    function renderSkillTags(skills) {
      const container = document.getElementById('skillTags');
      container.innerHTML = '';
      
      skills.forEach((skill, index) => {
        const tag = document.createElement('span');
        tag.className = 'skill-tag cursor-pointer';
        tag.innerHTML = `${skill} <span onclick="removeSkill(${index})" class="ml-1 text-red-500">Ã—</span>`;
        container.appendChild(tag);
      });
    }

    // ã‚¹ã‚­ãƒ«è¿½åŠ 
    function addSkill() {
      const newSkill = document.getElementById('newSkillInput').value.trim();
      if (!newSkill) return;
      
      let skills = currentStaff ? [...(currentStaff.skills || [])] : [];
      if (!skills.includes(newSkill)) {
        skills.push(newSkill);
        renderSkillTags(skills);
        document.getElementById('newSkillInput').value = '';
        
        if (currentStaff) {
          currentStaff.skills = skills;
        }
      }
    }

    // ã‚¹ã‚­ãƒ«å‰Šé™¤
    function removeSkill(index) {
      let skills = currentStaff ? [...(currentStaff.skills || [])] : [];
      skills.splice(index, 1);
      renderSkillTags(skills);
      
      if (currentStaff) {
        currentStaff.skills = skills;
      }
    }

    // å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
    async function handlePhotoUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      try {
        const fileName = `staffs/${Date.now()}_${file.name}`;
        const storageRef = storage.ref().child(fileName);
        const snapshot = await storageRef.put(file);
        const downloadURL = await snapshot.ref.getDownloadURL();
        
        document.getElementById('editStaffPhotoURL').value = downloadURL;
        renderPhotoPreview();
        alert('å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
        
      } catch (error) {
        console.error('å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
        alert('å†™çœŸã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    // å†™çœŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    function renderPhotoPreview() {
      const container = document.getElementById('photoPreview');
      const photoURL = document.getElementById('editStaffPhotoURL').value;
      
      container.innerHTML = '';
      
      if (photoURL) {
        const preview = document.createElement('div');
        preview.className = 'image-preview';
        preview.innerHTML = `
          <img src="${photoURL}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ">
          <button class="remove-btn" onclick="removePhoto()">Ã—</button>
        `;
        container.appendChild(preview);
      }
    }

    // å†™çœŸå‰Šé™¤
    function removePhoto() {
      document.getElementById('editStaffPhotoURL').value = '';
      renderPhotoPreview();
    }

    // ã‚¹ã‚¿ãƒƒãƒ•ä¿å­˜
    async function saveStaff() {
      try {
        // å‹¤å‹™æ›œæ—¥ã®å–å¾—
        const workdays = [];
        for (let i = 0; i < 7; i++) {
          if (document.getElementById(`workday-${i}`).checked) {
            workdays.push(i);
          }
        }
        
        const staffData = {
          name: document.getElementById('editStaffName').value.trim(),
          role: document.getElementById('editStaffRole').value,
          status: document.getElementById('editStaffStatus').value,
          phone: document.getElementById('editStaffPhone').value.trim(),
          email: document.getElementById('editStaffEmail').value.trim(),
          hireDate: document.getElementById('editStaffHireDate').value,
          bio: document.getElementById('editStaffBio').value.trim(),
          photoURL: document.getElementById('editStaffPhotoURL').value.trim(),
          specialty: document.getElementById('editStaffSpecialty').value.trim(),
          skills: currentStaff ? (currentStaff.skills || []) : [],
          experience: parseInt(document.getElementById('editStaffExperience').value) || 0,
          workdays: workdays,
          startTime: document.getElementById('editStaffStartTime').value,
          endTime: document.getElementById('editStaffEndTime').value,
          updatedAt: new Date().toISOString()
        };
        
        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        if (!staffData.name || !staffData.role) {
          alert('æ°åã¨å½¹è·ã¯å¿…é ˆã§ã™');
          return;
        }
        
        if (currentStaff) {
          // æ›´æ–°
          await db.collection('staffs').doc(currentStaff.id).update(staffData);
          Object.assign(currentStaff, staffData);
          const index = staffsData.findIndex(s => s.id === currentStaff.id);
          if (index !== -1) {
            Object.assign(staffsData[index], staffData);
          }
        } else {
          // æ–°è¦ä½œæˆ
          staffData.createdAt = new Date().toISOString();
          const docRef = await db.collection('staffs').add(staffData);
          staffData.id = docRef.id;
          staffsData.push(staffData);
        }
        
        applyFilters();
        updateStatistics();
        closeModal();
        alert('ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        
      } catch (error) {
        console.error('ã‚¹ã‚¿ãƒƒãƒ•ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    // ã‚¹ã‚¿ãƒƒãƒ•å‰Šé™¤
    async function deleteStaff() {
      if (!currentStaff || !confirm('ã“ã®ã‚¹ã‚¿ãƒƒãƒ•ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
      
      try {
        await db.collection('staffs').doc(currentStaff.id).delete();
        
        const index = staffsData.findIndex(s => s.id === currentStaff.id);
        if (index !== -1) {
          staffsData.splice(index, 1);
        }
        
        applyFilters();
        updateStatistics();
        closeModal();
        alert('ã‚¹ã‚¿ãƒƒãƒ•ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        
      } catch (error) {
        console.error('ã‚¹ã‚¿ãƒƒãƒ•å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚¹ã‚¿ãƒƒãƒ•ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
    function closeModal() {
      document.getElementById('staffModal').classList.remove('active');
      currentStaff = null;
    }

    // CSVå‡ºåŠ›
    function exportToCSV() {
      const headers = [
        'ã‚¹ã‚¿ãƒƒãƒ•ID', 'æ°å', 'å½¹è·', 'å‹¤å‹™çŠ¶æ³', 'é›»è©±ç•ªå·', 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', 
        'å…¥ç¤¾æ—¥', 'å¾—æ„åˆ†é‡', 'ã‚¹ã‚­ãƒ«', 'çµŒé¨“å¹´æ•°', 'é–‹å§‹æ™‚é–“', 'çµ‚äº†æ™‚é–“', 'ä½œæˆæ—¥æ™‚'
      ];
      
      const csvData = filteredStaffs.map(staff => [
        staff.id,
        staff.name,
        staff.role,
        staff.status === 'active' ? 'åœ¨ç±ä¸­' : staff.status === 'vacation' ? 'ä¼‘æš‡ä¸­' : 'é€€è·',
        staff.phone || '',
        staff.email || '',
        staff.hireDate || '',
        staff.specialty || '',
        (staff.skills || []).join(';'),
        staff.experience || 0,
        staff.startTime || '',
        staff.endTime || '',
        staff.createdAt ? new Date(staff.createdAt).toLocaleString('ja-JP') : ''
      ]);
      
      const csvContent = [headers, ...csvData]
        .map(row => row.map(field => `"${field}"`).join(','))
        .join('\n');
      
      const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§_${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
    window.openStaffModal = openStaffModal;
    window.removeSkill = removeSkill;
    window.removePhoto = removePhoto;
  </script>
</body>
</html>