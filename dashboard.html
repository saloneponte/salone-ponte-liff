<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>予約カレンダー</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 10px;
    }
    select, button {
      font-size: 1.2em;
      margin: 0.5em 0;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1em;
    }
    th, td {
      border: 1px solid #ccc;
      text-align: center;
      padding: 5px;
    }
    th {
      background-color: #f0f0f0;
    }
    .available {
      background-color: #c8facc;
      cursor: pointer;
    }
    .booked {
      background-color: #f9caca;
      cursor: not-allowed;
    }
    .time-col {
      font-weight: bold;
      background-color: #f9f9f9;
    }
    .selected {
      outline: 3px solid #007aff;
    }
  </style>
</head>
<body>
  <h2>予約カレンダー</h2>

  <label for="menu">メニュー選択：</label>
  <select id="menu">
    <option value="">選択してください</option>
    <option value="cut">カット（30分）</option>
    <option value="color">カラー（60分）</option>
    <option value="perm">パーマ（90分）</option>
  </select>

  <label for="staff">スタッフ選択：</label>
  <select id="staff">
    <option value="">選択してください</option>
    <option value="staffA">スタッフA</option>
    <option value="staffB">スタッフB</option>
  </select>

  <table id="calendar"></table>

  <script>
    const calendar = document.getElementById("calendar");
    const menuDurations = { cut: 30, color: 60, perm: 90 };
    const timeSlots = Array.from({ length: 16 }, (_, i) => `${String(10 + Math.floor(i / 2)).padStart(2, '0')}:${i % 2 === 0 ? '00' : '30'}`);

    function generateCalendar() {
      const menu = document.getElementById("menu").value;
      const staff = document.getElementById("staff").value;
      if (!menu || !staff) return calendar.innerHTML = "";

      const days = [];
      const today = new Date();
      for (let i = 0; i < 7; i++) {
        const d = new Date(today);
        d.setDate(d.getDate() + i);
        days.push({
          label: `${d.getMonth() + 1}/${d.getDate()} (${"日月火水木金土"[d.getDay()]})`,
          date: d.toISOString().split("T")[0],
        });
      }

      let html = "<tr><th></th>" + days.map(d => `<th>${d.label}</th>`).join("") + "</tr>";
      timeSlots.forEach(time => {
        html += `<tr><td class='time-col'>${time}</td>`;
        days.forEach(day => {
          html += `<td class="available" data-date="${day.date}" data-time="${time}">○</td>`;
        });
        html += "</tr>";
      });
      calendar.innerHTML = html;

      // click event
      document.querySelectorAll("td.available").forEach(td => {
        td.addEventListener("click", () => {
          document.querySelectorAll("td").forEach(c => c.classList.remove("selected"));
          td.classList.add("selected");
          const selectedDate = td.getAttribute("data-date");
          const selectedTime = td.getAttribute("data-time");
          alert(`予約日時: ${selectedDate} ${selectedTime}`);
          // TODO: Firebase保存処理
        });
      });
    }

    document.getElementById("menu").addEventListener("change", generateCalendar);
    document.getElementById("staff").addEventListener("change", generateCalendar);
  </script>
</body>
</html>
