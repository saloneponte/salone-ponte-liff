<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Salone Ponte 統合管理システム</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .tab-active {
      @apply bg-blue-500 text-white border-blue-500;
    }
    
    .tag {
      @apply inline-block px-2 py-1 text-xs rounded-full;
    }
    .tag-vip { @apply bg-purple-100 text-purple-800; }
    .tag-regular { @apply bg-green-100 text-green-800; }
    .tag-new { @apply bg-blue-100 text-blue-800; }
    .tag-risk { @apply bg-red-100 text-red-800; }
    .tag-custom { @apply bg-gray-100 text-gray-800; }
    
    .modal {
      @apply fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50;
    }
    
    .modal.active {
      @apply flex;
    }

    .side-nav {
      @apply fixed left-0 top-0 h-full w-64 bg-gray-900 text-white transform -translate-x-full transition-transform duration-300 z-40;
    }

    .side-nav.active {
      @apply translate-x-0;
    }

    .main-content {
      @apply transition-all duration-300;
    }

    .main-content.shifted {
      @apply ml-64;
    }

    .menu-overlay {
      @apply fixed inset-0 bg-black bg-opacity-50 hidden z-30;
    }

    .menu-overlay.active {
      @apply block;
    }

    @media (max-width: 768px) {
      .main-content.shifted {
        @apply ml-0;
      }
    }

    .message-thread {
      max-height: 400px;
      overflow-y: auto;
    }

    .message-item {
      @apply mb-3 p-3 rounded-lg;
    }

    .message-sent {
      @apply bg-blue-100 ml-8;
    }

    .message-received {
      @apply bg-gray-100 mr-8;
    }

    .online-indicator {
      @apply w-3 h-3 bg-green-400 rounded-full absolute -top-1 -right-1;
    }

    .chat-list-item {
      @apply p-3 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors;
    }

    .chat-list-item.active {
      @apply bg-blue-50 border-blue-200;
    }

    .unread-badge {
      @apply bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- サイドナビゲーション -->
  <nav id="sideNav" class="side-nav">
    <div class="p-6">
      <h2 class="text-xl font-bold mb-6">💇‍♀️ Salone Ponte</h2>
      <ul class="space-y-2">
        <li>
          <button data-tab="dashboard" class="nav-item w-full text-left px-4 py-2 rounded hover:bg-gray-800 transition-colors">
            📊 ダッシュボード
          </button>
        </li>
        <li>
          <a href="customer-management.html" class="nav-item w-full text-left px-4 py-2 rounded hover:bg-gray-800 transition-colors block">
            👥 顧客管理
          </a>
        </li>
        <li>
          <a href="reservation-management.html" class="nav-item w-full text-left px-4 py-2 rounded hover:bg-gray-800 transition-colors block">
            📅 予約管理
          </a>
        </li>
        <li>
          <a href="menu-management.html" class="nav-item w-full text-left px-4 py-2 rounded hover:bg-gray-800 transition-colors block">
            📋 メニュー管理
          </a>
        </li>
        <li>
          <a href="staff-management.html" class="nav-item w-full text-left px-4 py-2 rounded hover:bg-gray-800 transition-colors block">
            👨‍💼 スタッフ管理
          </a>
        </li>
        <li>
          <button data-tab="counseling" class="nav-item w-full text-left px-4 py-2 rounded hover:bg-gray-800 transition-colors">
            📋 カウンセリング
          </button>
        </li>
        <li>
          <button data-tab="messaging" class="nav-item w-full text-left px-4 py-2 rounded hover:bg-gray-800 transition-colors relative">
            💬 メッセージ配信
            <span id="messageNotification" class="unread-badge hidden absolute top-1 right-1">0</span>
          </button>
        </li>
        <li>
          <button data-tab="analytics" class="nav-item w-full text-left px-4 py-2 rounded hover:bg-gray-800 transition-colors">
            📈 売上分析
          </button>
        </li>
      </ul>
    </div>
  </nav>

  <!-- メニューオーバーレイ（モバイル用） -->
  <div id="menuOverlay" class="menu-overlay" onclick="closeSideNav()"></div>

  <!-- メインコンテンツ -->
  <div id="mainContent" class="main-content">
    <!-- トップバー -->
    <div class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center">
          <button id="menuToggle" class="md:hidden mr-4 p-2" onclick="toggleSideNav()">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
          <h1 id="pageTitle" class="text-2xl font-bold text-gray-800">ダッシュボード</h1>
        </div>
        <div class="flex items-center space-x-4">
          <button onclick="openBookingPage()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
            📅 予約画面を開く
          </button>
          <div class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
              <span class="text-white text-sm font-medium">管</span>
            </div>
            <span class="text-sm font-medium">管理者</span>
          </div>
        </div>
      </div>
    </div>

    <!-- コンテンツエリア -->
    <div class="p-6">
      <!-- ダッシュボードタブ -->
      <div id="dashboardTab" class="tab-content">
        <!-- 統計サマリー -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
          <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-blue-100 text-blue-600">👥</div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">総顧客数</p>
                <p class="text-2xl font-semibold text-gray-900" id="totalCustomers">0</p>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-green-100 text-green-600">📅</div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">今月予約</p>
                <p class="text-2xl font-semibold text-gray-900" id="monthlyReservations">0</p>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-purple-100 text-purple-600">💰</div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">今月売上</p>
                <p class="text-2xl font-semibold text-gray-900" id="monthlyRevenue">¥0</p>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-red-100 text-red-600">⚠️</div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">要フォロー</p>
                <p class="text-2xl font-semibold text-gray-900" id="needFollowUp">0</p>
              </div>
            </div>
          </div>
        </div>

        <!-- 最近の予約 -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-lg font-semibold mb-4">最近の予約</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">日時</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">顧客</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">メニュー</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">スタッフ</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">金額</th>
                </tr>
              </thead>
              <tbody id="recentReservations" class="bg-white divide-y divide-gray-200">
                <!-- データは JavaScript で動的に生成 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- 顧客管理タブ -->
      <div id="customersTab" class="tab-content hidden">
        <!-- 検索・フィルター -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">顧客検索</label>
              <input type="text" id="customerSearch" placeholder="名前・電話番号で検索" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">タグ絞り込み</label>
              <select id="customerTagFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">全て</option>
                <option value="VIP顧客">VIP顧客</option>
                <option value="常連顧客">常連顧客</option>
                <option value="新規顧客">新規顧客</option>
                <option value="離反リスク">離反リスク</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">来店期間</label>
              <select id="customerVisitFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">全期間</option>
                <option value="30">30日以内</option>
                <option value="60">60日以内</option>
                <option value="90">90日以内</option>
                <option value="180">180日以上</option>
              </select>
            </div>
            <div class="flex items-end space-x-2">
              <button onclick="applyCustomerFilters()" class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors">
                検索
              </button>
              <button onclick="resetCustomerFilters()" class="flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors">
                リセット
              </button>
            </div>
          </div>
        </div>

        <!-- 顧客一覧 -->
        <div class="bg-white rounded-lg shadow-md">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">顧客一覧</h3>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">顧客情報</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">タグ</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">来店情報</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">累計金額</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">最終来店</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                </tr>
              </thead>
              <tbody id="customersTable" class="bg-white divide-y divide-gray-200">
                <!-- 顧客データは JavaScript で動的に生成 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- 予約管理タブ -->
      <div id="reservationsTab" class="tab-content hidden">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-lg font-semibold mb-4">予約管理</h3>
          
          <!-- 予約フィルター -->
          <div class="flex flex-wrap gap-4 mb-6">
            <select id="reservationDateFilter" class="px-3 py-2 border border-gray-300 rounded-md">
              <option value="today">今日</option>
              <option value="tomorrow">明日</option>
              <option value="week">今週</option>
              <option value="month">今月</option>
            </select>
            <select id="reservationStaffFilter" class="px-3 py-2 border border-gray-300 rounded-md">
              <option value="">全スタッフ</option>
            </select>
            <select id="reservationStatusFilter" class="px-3 py-2 border border-gray-300 rounded-md">
              <option value="">全ステータス</option>
              <option value="confirmed">確定</option>
              <option value="completed">完了</option>
              <option value="cancelled">キャンセル</option>
            </select>
            <button onclick="applyReservationFilters()" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">
              フィルター適用
            </button>
          </div>
          
          <!-- 予約一覧 -->
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">日時</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">顧客</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">メニュー</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">スタッフ</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">金額</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ステータス</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">操作</th>
                </tr>
              </thead>
              <tbody id="reservationsTable" class="bg-white divide-y divide-gray-200">
                <!-- 予約データは JavaScript で動的に生成 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- メニュー・スタッフ管理タブ -->
      <div id="menuStaffTab" class="tab-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- メニュー管理 -->
          <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold">🍽️ メニュー管理</h3>
              <button onclick="openMenuModal()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                + 新規メニュー
              </button>
            </div>
            <div id="menuList" class="space-y-4">
              <!-- メニューリストは JavaScript で生成 -->
            </div>
          </div>

          <!-- スタッフ管理 -->
          <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold">👩‍💼 スタッフ管理</h3>
              <button onclick="openStaffModal()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                + 新規スタッフ
              </button>
            </div>
            <div id="staffList" class="space-y-4">
              <!-- スタッフリストは JavaScript で生成 -->
            </div>
          </div>
        </div>

        <!-- 営業設定 -->
        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
          <h3 class="text-lg font-semibold mb-4">🕐 営業時間・休業日設定</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h4 class="font-medium mb-3">営業時間</h4>
              <div class="space-y-3">
                <div class="flex items-center space-x-4">
                  <span class="w-16 text-sm">平日:</span>
                  <input type="time" id="weekdayOpen" value="10:00" class="px-3 py-2 border border-gray-300 rounded-md">
                  <span>〜</span>
                  <input type="time" id="weekdayClose" value="19:00" class="px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div class="flex items-center space-x-4">
                  <span class="w-16 text-sm">土日:</span>
                  <input type="time" id="weekendOpen" value="10:00" class="px-3 py-2 border border-gray-300 rounded-md">
                  <span>〜</span>
                  <input type="time" id="weekendClose" value="18:00" class="px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </div>
            <div>
              <h4 class="font-medium mb-3">定休日</h4>
              <div class="grid grid-cols-2 gap-2">
                <label class="flex items-center space-x-2">
                  <input type="checkbox" id="closedSunday" checked class="rounded">
                  <span class="text-sm">日曜日</span>
                </label>
                <label class="flex items-center space-x-2">
                  <input type="checkbox" id="closedMonday" class="rounded">
                  <span class="text-sm">月曜日</span>
                </label>
                <label class="flex items-center space-x-2">
                  <input type="checkbox" id="closedTuesday" class="rounded">
                  <span class="text-sm">火曜日</span>
                </label>
                <label class="flex items-center space-x-2">
                  <input type="checkbox" id="closedWednesday" class="rounded">
                  <span class="text-sm">水曜日</span>
                </label>
                <label class="flex items-center space-x-2">
                  <input type="checkbox" id="closedThursday" class="rounded">
                  <span class="text-sm">木曜日</span>
                </label>
                <label class="flex items-center space-x-2">
                  <input type="checkbox" id="closedFriday" class="rounded">
                  <span class="text-sm">金曜日</span>
                </label>
                <label class="flex items-center space-x-2">
                  <input type="checkbox" id="closedSaturday" class="rounded">
                  <span class="text-sm">土曜日</span>
                </label>
              </div>
            </div>
          </div>
          <button onclick="saveBusinessSettings()" class="mt-4 bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
            営業設定を保存
          </button>
        </div>
      </div>

      <!-- カウンセリングタブ -->
      <div id="counselingTab" class="tab-content hidden">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-lg font-semibold mb-4">📋 カウンセリングシート管理</h3>
          
          <!-- カウンセリングシート一覧 -->
          <div class="mb-6">
            <div class="flex justify-between items-center mb-4">
              <h4 class="font-medium">未実施カウンセリング</h4>
              <button onclick="createCounselingTemplate()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                + テンプレート作成
              </button>
            </div>
            <div id="pendingCounseling" class="space-y-4">
              <!-- 未実施カウンセリングリスト -->
            </div>
          </div>

          <!-- 完了済みカウンセリング -->
          <div>
            <h4 class="font-medium mb-4">完了済みカウンセリング</h4>
            <div id="completedCounseling" class="space-y-4">
              <!-- 完了済みカウンセリングリスト -->
            </div>
          </div>
        </div>
      </div>

      <!-- メッセージ配信タブ -->
      <div id="messagingTab" class="tab-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- 顧客リスト -->
          <div class="bg-white rounded-lg shadow-md">
            <div class="p-4 border-b border-gray-200">
              <h3 class="text-lg font-semibold">顧客リスト</h3>
              <div class="mt-2">
                <input type="text" id="chatSearch" placeholder="顧客検索..." 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
              </div>
            </div>
            <div id="chatList" class="max-h-96 overflow-y-auto">
              <!-- 顧客チャットリスト -->
            </div>
          </div>

          <!-- チャット画面 -->
          <div class="lg:col-span-2 bg-white rounded-lg shadow-md flex flex-col">
            <div id="chatHeader" class="p-4 border-b border-gray-200 bg-gray-50">
              <div class="flex items-center">
                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-medium mr-3">
                  顧
                </div>
                <div>
                  <h4 class="font-medium">顧客を選択してください</h4>
                  <p class="text-sm text-gray-500">左の一覧から顧客を選択してメッセージを開始</p>
                </div>
              </div>
            </div>
            
            <div id="chatMessages" class="flex-1 p-4 message-thread">
              <div class="text-center text-gray-500">
                顧客を選択してください
              </div>
            </div>
            
            <div id="chatInput" class="p-4 border-t border-gray-200" style="display: none;">
              <div class="flex space-x-2">
                <input type="text" id="messageInput" placeholder="メッセージを入力..." 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-md">
                <button onclick="sendMessage()" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">
                  送信
                </button>
              </div>
              
              <!-- クイック返信テンプレート -->
              <div class="mt-3">
                <div class="text-sm text-gray-600 mb-2">クイック返信:</div>
                <div class="flex flex-wrap gap-2">
                  <button onclick="insertQuickReply('ご予約ありがとうございます。当日お待ちしております。')" 
                          class="text-xs bg-gray-100 px-2 py-1 rounded hover:bg-gray-200">
                    予約確認
                  </button>
                  <button onclick="insertQuickReply('お疲れ様でした。またのご来店をお待ちしております。')" 
                          class="text-xs bg-gray-100 px-2 py-1 rounded hover:bg-gray-200">
                    施術後
                  </button>
                  <button onclick="insertQuickReply('お久しぶりです。いかがお過ごしでしょうか？')" 
                          class="text-xs bg-gray-100 px-2 py-1 rounded hover:bg-gray-200">
                    フォローアップ
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

                    <!-- 一括配信設定 -->
        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
          <h3 class="text-lg font-semibold mb-4">📢 一括メッセージ配信</h3>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">配信対象</label>
                  <select id="broadcastTarget" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="all">全顧客</option>
                    <option value="vip">VIP顧客</option>
                    <option value="regular">常連顧客</option>
                    <option value="new">新規顧客</option>
                    <option value="inactive">離反リスク顧客</option>
                    <option value="birthday">今月誕生日</option>
                    <option value="lastMonth">先月来店</option>
                  </select>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">メッセージタイプ</label>
                  <select id="messageType" onchange="loadMessageTemplate()" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="custom">カスタム</option>
                    <option value="reminder">来店リマインダー</option>
                    <option value="birthday">誕生日メッセージ</option>
                    <option value="campaign">キャンペーン告知</option>
                    <option value="seasonal">季節限定メニュー</option>
                    <option value="followup">アフターフォロー</option>
                  </select>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">メッセージ内容</label>
                  <textarea id="broadcastMessage" rows="6" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                            placeholder="メッセージを入力してください..."></textarea>
                </div>

                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="scheduleMessage" class="rounded">
                  <label for="scheduleMessage" class="text-sm text-gray-700">予約配信</label>
                </div>

                <div id="scheduleSettings" class="hidden">
                  <label class="block text-sm font-medium text-gray-700 mb-2">配信日時</label>
                  <input type="datetime-local" id="scheduleDateTime" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>

                <div class="flex space-x-3">
                  <button onclick="previewBroadcast()" class="flex-1 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                    プレビュー
                  </button>
                  <button onclick="sendBroadcast()" class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                    配信実行
                  </button>
                </div>
              </div>
            </div>

            <div>
              <h4 class="font-medium mb-3">配信統計</h4>
              <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg">
                  <div class="text-2xl font-bold text-blue-600" id="totalMessages">0</div>
                  <div class="text-sm text-gray-600">総配信数</div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                  <div class="text-2xl font-bold text-green-600" id="messageOpenRate">0%</div>
                  <div class="text-sm text-gray-600">開封率</div>
                </div>
              </div>

              <h4 class="font-medium mb-3">最近の配信</h4>
              <div id="messageHistory" class="space-y-3 max-h-64 overflow-y-auto">
                <!-- 配信履歴は JavaScript で生成 -->
              </div>
            </div>
          </div>
        </div>

        <!-- 自動配信設定 -->
        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
          <h3 class="text-lg font-semibold mb-4">🤖 自動配信設定</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="p-4 border border-gray-200 rounded-lg">
              <div class="flex items-center justify-between mb-3">
                <h4 class="font-medium">予約リマインダー</h4>
                <input type="checkbox" id="autoReminder" class="rounded">
              </div>
              <p class="text-sm text-gray-600 mb-3">予約前日にリマインダーを自動送信</p>
              <div class="space-y-2">
                <label class="block text-xs text-gray-500">送信時間</label>
                <input type="time" id="reminderTime" value="18:00" class="w-full px-2 py-1 border border-gray-300 rounded text-sm">
              </div>
            </div>

            <div class="p-4 border border-gray-200 rounded-lg">
              <div class="flex items-center justify-between mb-3">
                <h4 class="font-medium">誕生日メッセージ</h4>
                <input type="checkbox" id="autoBirthday" class="rounded">
              </div>
              <p class="text-sm text-gray-600 mb-3">誕生日当日に自動でお祝いメッセージ送信</p>
              <div class="space-y-2">
                <label class="block text-xs text-gray-500">送信時間</label>
                <input type="time" id="birthdayTime" value="09:00" class="w-full px-2 py-1 border border-gray-300 rounded text-sm">
              </div>
            </div>

            <div class="p-4 border border-gray-200 rounded-lg">
              <div class="flex items-center justify-between mb-3">
                <h4 class="font-medium">離反防止</h4>
                <input type="checkbox" id="autoRetention" class="rounded">
              </div>
              <p class="text-sm text-gray-600 mb-3">90日未来店の顧客に自動でメッセージ送信</p>
              <div class="space-y-2">
                <label class="block text-xs text-gray-500">実行間隔</label>
                <select id="retentionInterval" class="w-full px-2 py-1 border border-gray-300 rounded text-sm">
                  <option value="weekly">週1回</option>
                  <option value="monthly">月1回</option>
                </select>
              </div>
            </div>
          </div>
          
          <button onclick="saveAutoMessageSettings()" class="mt-6 bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
            自動配信設定を保存
          </button>
        </div>
      </div>

      <!-- 売上分析タブ -->
      <div id="analyticsTab" class="tab-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- 売上グラフ -->
          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-semibold mb-4">📈 月別売上推移</h3>
            <canvas id="revenueChart" width="400" height="300"></canvas>
          </div>

          <!-- メニュー別売上 -->
          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-semibold mb-4">🍽️ メニュー別売上</h3>
            <canvas id="menuRevenueChart" width="400" height="300"></canvas>
          </div>
        </div>

        <!-- 詳細統計 -->
        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
          <h3 class="text-lg font-semibold mb-4">📊 詳細統計</h3>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div>
              <div class="text-2xl font-bold text-blue-600" id="avgTicket">¥0</div>
              <div class="text-sm text-gray-600">平均客単価</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-green-600" id="repeatRate">0%</div>
              <div class="text-sm text-gray-600">リピート率</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-purple-600" id="customerLTV">¥0</div>
              <div class="text-sm text-gray-600">平均LTV</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-orange-600" id="growthRate">0%</div>
              <div class="text-sm text-gray-600">前月比成長率</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 顧客詳細モーダル -->
  <div id="customerModal" class="modal">
    <div class="bg-white rounded-lg w-full max-w-4xl mx-4 max-h-full overflow-y-auto">
      <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
        <h3 class="text-lg font-semibold text-gray-900" id="modalCustomerName">顧客カルテ</h3>
        <button id="closeCustomerModal" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="p-6">
        <!-- カウンセリングシート -->
        <div class="bg-blue-50 p-4 rounded-lg mb-6">
          <h4 class="font-semibold mb-3">📋 カウンセリングシート</h4>
          <div id="customerCounseling">
            <!-- カウンセリング内容は JavaScript で生成 -->
          </div>
          <button onclick="openCounselingModal()" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors">
            カウンセリング実施
          </button>
        </div>

        <!-- 基本情報 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold mb-3">基本情報</h4>
            <div id="customerBasicInfo" class="space-y-2">
              <!-- 基本情報は JavaScript で生成 -->
            </div>
          </div>
          
          <div>
            <h4 class="font-semibold mb-3">来店履歴</h4>
            <div id="customerVisitHistory" class="space-y-2 max-h-64 overflow-y-auto">
              <!-- 来店履歴は JavaScript で生成 -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- メニュー編集モーダル -->
  <div id="menuModal" class="modal">
    <div class="bg-white rounded-lg w-full max-w-md mx-4">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900" id="menuModalTitle">メニュー編集</h3>
      </div>
      <div class="p-6">
        <form id="menuForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">メニュー名</label>
            <input type="text" id="menuName" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">料金</label>
            <input type="number" id="menuPrice" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">所要時間（分）</label>
            <input type="number" id="menuDuration" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">説明</label>
            <textarea id="menuDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">画像URL</label>
            <input type="url" id="menuPhotoURL" class="w-full px-3 py-2 border border-gray-300 rounded-md">
          </div>
          <div class="flex space-x-3">
            <button type="button" onclick="closeMenuModal()" class="flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
              キャンセル
            </button>
            <button type="submit" class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">
              保存
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- スタッフ編集モーダル -->
  <div id="staffModal" class="modal">
    <div class="bg-white rounded-lg w-full max-w-md mx-4">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900" id="staffModalTitle">スタッフ編集</h3>
      </div>
      <div class="p-6">
        <form id="staffForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">スタッフ名</label>
            <input type="text" id="staffName" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">役職</label>
            <select id="staffRole" class="w-full px-3 py-2 border border-gray-300 rounded-md">
              <option value="スタイリスト">スタイリスト</option>
              <option value="トップスタイリスト">トップスタイリスト</option>
              <option value="アシスタント">アシスタント</option>
              <option value="店長">店長</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">得意分野</label>
            <textarea id="staffSpecialty" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">写真URL</label>
            <input type="url" id="staffPhotoURL" class="w-full px-3 py-2 border border-gray-300 rounded-md">
          </div>
          <div class="flex space-x-3">
            <button type="button" onclick="closeStaffModal()" class="flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
              キャンセル
            </button>
            <button type="submit" class="flex-1 bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600">
              保存
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- カウンセリングモーダル -->
  <div id="counselingModal" class="modal">
    <div class="bg-white rounded-lg w-full max-w-3xl mx-4 max-h-full overflow-y-auto">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">📋 カウンセリングシート</h3>
      </div>
      <div class="p-6">
        <form id="counselingForm" class="space-y-6">
          <!-- 基本情報 -->
          <div>
            <h4 class="font-medium mb-3">基本情報</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">髪質</label>
                <select id="counselingHairType" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                  <option value="">選択してください</option>
                  <option value="ストレート">ストレート</option>
                  <option value="ウェーブ">ウェーブ</option>
                  <option value="カール">カール</option>
                  <option value="くせ毛">くせ毛</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">髪の量</label>
                <select id="counselingHairVolume" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                  <option value="">選択してください</option>
                  <option value="少ない">少ない</option>
                  <option value="普通">普通</option>
                  <option value="多い">多い</option>
                </select>
              </div>
            </div>
          </div>

          <!-- 髪の悩み -->
          <div>
            <h4 class="font-medium mb-3">髪の悩み・希望</h4>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">現在の髪の悩み</label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" class="hair-concern" value="パサつき" class="rounded">
                    <span class="text-sm">パサつき</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" class="hair-concern" value="うねり" class="rounded">
                    <span class="text-sm">うねり</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" class="hair-concern" value="ボリューム不足" class="rounded">
                    <span class="text-sm">ボリューム不足</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" class="hair-concern" value="白髪" class="rounded">
                    <span class="text-sm">白髪</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" class="hair-concern" value="頭皮の悩み" class="rounded">
                    <span class="text-sm">頭皮の悩み</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" class="hair-concern" value="その他" class="rounded">
                    <span class="text-sm">その他</span>
                  </label>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">希望するスタイル</label>
                <textarea id="counselingDesiredStyle" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                          placeholder="どのようなスタイルをご希望ですか？"></textarea>
              </div>
            </div>
          </div>

          <!-- ライフスタイル -->
          <div>
            <h4 class="font-medium mb-3">ライフスタイル</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">朝のスタイリング時間</label>
                <select id="counselingStylingTime" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                  <option value="">選択してください</option>
                  <option value="5分以内">5分以内</option>
                  <option value="10分程度">10分程度</option>
                  <option value="15分程度">15分程度</option>
                  <option value="20分以上">20分以上</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">使用中のスタイリング剤</label>
                <input type="text" id="counselingStylingProducts" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                       placeholder="例）ワックス、ムース、オイル等">
              </div>
            </div>
          </div>

          <!-- アレルギー・注意事項 -->
          <div>
            <h4 class="font-medium mb-3">アレルギー・注意事項</h4>
            <div class="space-y-3">
              <div>
                <label class="flex items-center space-x-2">
                  <input type="checkbox" id="hasAllergies" class="rounded">
                  <span class="text-sm">アレルギーがある</span>
                </label>
              </div>
              <div id="allergyDetails" class="hidden">
                <textarea id="counselingAllergies" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                          placeholder="アレルギーの詳細をご記入ください"></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">その他注意事項</label>
                <textarea id="counselingNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                          placeholder="施術時に注意すべき点があればご記入ください"></textarea>
              </div>
            </div>
          </div>

          <div class="flex space-x-3">
            <button type="button" onclick="closeCounselingModal()" class="flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
              キャンセル
            </button>
            <button type="submit" class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">
              カウンセリング保存
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  
  <!-- 設定ファイル読み込み -->
  <script src="/src/config/constants.js"></script>
  <script src="/src/config/firebase.js"></script>

  <!-- JavaScript読み込み -->
  <script src="/src/scripts/dashboard.js"></script>
  <script>
    // ダッシュボード固有の初期化コード
    window.addEventListener('load', function() {
      // リアルタイム更新を開始
      setupRealtimeUpdates();
    });
  </script>
</body>
</html>